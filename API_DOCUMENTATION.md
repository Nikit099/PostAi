# ContentGenie API Documentation

## Обзор

ContentGenie предоставляет REST API для взаимодействия с основными функциями приложения. Все API эндпоинты защищены и требуют аутентификации пользователя.

## Базовый URL

```
https://your-domain.com/api
```

## Аутентификация

Все запросы к защищенным эндпоинтам должны включать сессионный токен в cookies (обрабатывается автоматически через Supabase Auth).

## Эндпоинты

### 1. Генерация поста

**POST** `/api/generate`

Генерирует пост на основе идеи пользователя с использованием DeepSeek API.

#### Запрос

```json
{
  "idea": "Идея для поста о пользе утренней зарядки",
  "userId": "uuid-пользователя"
}
```

#### Ответ

```json
{
  "success": true,
  "text": "Сгенерированный текст поста...",
  "credits_left": 5
}
```

#### Ошибки

- `400` - Отсутствуют обязательные поля
- `429` - Превышен дневной лимит генераций
- `500` - Внутренняя ошибка сервера

### 2. Транскрибация аудио

**POST** `/api/transcribe`

Преобразует голосовое сообщение в текст с использованием GigaChat API.

#### Запрос

FormData с полями:
- `audio` - Аудиофайл (MP3, WAV, OGG, WebM)
- `userId` - ID пользователя

#### Ответ

```json
{
  "success": true,
  "text": "Транскрибированный текст из аудио"
}
```

#### Ошибки

- `400` - Отсутствует аудиофайл или неподдерживаемый формат
- `500` - Внутренняя ошибка сервера

### 3. Публикация поста

**POST** `/api/publish`

Публикует пост в выбранные социальные сети.

#### Запрос

```json
{
  "userId": "uuid-пользователя",
  "postId": "uuid-поста",
  "accountIds": ["uuid-аккаунта-1", "uuid-аккаунта-2"],
  "title": "Заголовок поста",
  "text": "Текст поста",
  "mediaUrls": ["url-изображения-1", "url-изображения-2"]
}
```

#### Ответ

```json
{
  "success": true,
  "results": [
    {
      "accountId": "uuid-аккаунта-1",
      "service": "telegram",
      "accountName": "Мой канал",
      "success": true,
      "error": null,
      "messageId": 123456
    },
    {
      "accountId": "uuid-аккаунта-2",
      "service": "instagram",
      "accountName": "Личный блог",
      "success": false,
      "error": "Invalid access token",
      "messageId": null
    }
  ]
}
```

#### Ошибки

- `400` - Отсутствуют обязательные поля
- `404` - Активные аккаунты не найдены
- `500` - Внутренняя ошибка сервера

## Интеграция с социальными сетями

### Telegram

#### Подключение аккаунта
1. Пользователь находит бота @ContentGenieBot
2. Отправляет команду `/connect`
3. Бот генерирует уникальный токен
4. Пользователь вводит токен в приложении

#### Публикация
- Используется Telegram Bot API
- Поддержка текста и изображений
- Публикация в каналы и группы

### Instagram

#### Подключение аккаунта
1. Пользователь создает приложение в Facebook Developer
2. Получает access token
3. Вводит данные в приложении

#### Публикация
- Используется Instagram Graph API
- Требуется бизнес-аккаунт
- Поддержка постов с изображениями

### VK

#### Подключение аккаунта
1. Пользователь создает ключ доступа в настройках сообщества
2. Получает access token
3. Вводит данные в приложении

#### Публикация
- Используется VK API
- Публикация на стену сообщества
- Поддержка вложений

## Лимиты и квоты

### Генерация постов
- 6 бесплатных генераций в день на пользователя
- Счетчик сбрасывается в 00:00 по UTC

### Транскрибация
- 10 минут аудио в день на пользователя
- Поддержка файлов до 25MB

### Публикация
- Неограниченное количество публикаций
- Ограничения накладываются API социальных сетей

## Обработка ошибок

Все ошибки возвращаются в формате:

```json
{
  "error": "Описание ошибки",
  "code": "КОД_ОШИБКИ" // опционально
}
```

### Коды ошибок

- `INVALID_INPUT` - Неверные входные данные
- `AUTH_REQUIRED` - Требуется аутентификация
- `RATE_LIMITED` - Превышен лимит запросов
- `SERVICE_UNAVAILABLE` - Сервис временно недоступен
- `INTERNAL_ERROR` - Внутренняя ошибка сервера

## Безопасность

### Защита данных
- Токены социальных сетей шифруются перед сохранением в БД
- Все запросы валидируются
- Реализована защита от CSRF атак

### Мониторинг
- Логирование всех API запросов
- Отслеживание подозрительной активности
- Регулярные аудиты безопасности

## Тестирование

### Локальное тестирование
```bash
# Тестирование генерации
curl -X POST http://localhost:3000/api/generate \
  -H "Content-Type: application/json" \
  -d '{"idea": "Тестовая идея", "userId": "test-user"}'

# Тестирование транскрибации
curl -X POST http://localhost:3000/api/transcribe \
  -F "audio=@test.mp3" \
  -F "userId=test-user"
```

### Production тестирование
Используйте Postman или аналогичные инструменты с реальными ключами API.

## Обновления API

Все breaking changes будут сопровождаться:
1. Уведомлением за 30 дней
2. Поддержкой старой версии в течение 60 дней
3. Подробной документацией по миграции

## Поддержка

Для вопросов по API:
- Откройте issue в репозитории
- Напишите на support@contentgenie.app
- Обратитесь в Telegram: @ContentGenieSupportBot